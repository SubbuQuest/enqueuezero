(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{289:function(e,t,s){"use strict";s.r(t);var r=s(0),a=Object(r.a)({},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[e._m(0),e._v(" "),e._m(1),e._v(" "),e._m(2),e._v(" "),s("p",[e._v("Skipper is an HTTP router and reverse proxy software written in Golang.\nIt has two goals:")]),e._v(" "),e._m(3),e._v(" "),e._m(4),e._v(" "),e._m(5),e._v(" "),e._m(6),e._v(" "),e._m(7),e._v(" "),s("p",[e._v("An HTTP proxy is a middleman in-between HTTP client and HTTP server.")]),e._v(" "),s("p",[e._v("With the HTTP proxy software running,")]),e._v(" "),e._m(8),e._v(" "),s("mermaid",[e._v("\nsequenceDiagram\n    Client->>Proxy: 1. send request\n    activate Proxy\n    Proxy->>Server: 2. forward request\n    activate Server\n    Server->>Proxy: 3. send response\n    deactivate Server\n    Proxy->>Client: 4. forward response\n    deactivate Proxy\n")]),e._v(" "),e._m(9),e._v(" "),s("p",[e._v("In networking, a route is a path for traffic in a network, or between or across multiple networks.  In Skipper, the route is an entry in a table, which defines where should the request be proxied to.")]),e._v(" "),s("p",[e._v("A route consists of below information.")]),e._v(" "),e._m(10),e._v(" "),s("p",[e._v("Below is the simplified Go code.")]),e._v(" "),e._m(11),e._m(12),e._v(" "),s("p",[e._v("The routing table stores all routes. It's a list in the memory.")]),e._v(" "),e._m(13),e._v(" "),s("p",[e._v("Predicates are tools in a route for matching a request.")]),e._v(" "),s("p",[e._v("For example, below route has three predicates matching designated host, method, and path.")]),e._v(" "),e._m(14),s("p",[e._v("Except host, method, and path, predicates can also match headers, cookies, time frames, query parameters, source IP addresses, etc.")]),e._v(" "),e._m(15),e._v(" "),s("p",[e._v("Filters are tools in a route for modifying the request and the response.")]),e._v(" "),s("p",[e._v("For example, sometimes we want to add a header to the HTTP request.")]),e._v(" "),s("mermaid",[e._v('\ngraph LR\n    A["-X GET https://enqueuezero.com"]\n    B("-X GET https://enqueuezero.com -H\'X-Routed-By: skipper\'")\n    A--\x3eB\n')]),e._v(" "),s("p",[e._v("Below route has a filter adding a header to the request before proxying to the backend HTTP.")]),e._v(" "),e._m(16),s("p",[e._v("Except adding header to the request, there are dozens of built-in functions for different features, such as dropping headers, modifying path, redirection, setting static directory, etc.")]),e._v(" "),e._m(17),e._v(" "),s("p",[e._v("Skipper has a built-in LUA engine for running scripts as filters.")]),e._v(" "),s("p",[e._v("For example, below script set a header to the request.")]),e._v(" "),e._m(18),s("p",[e._v("You can either load a file in the file system or use inline Lua code in the routes.")]),e._v(" "),e._m(19),e._m(20),e._v(" "),e._m(21),e._v(" "),s("mermaid",[e._v("\nsequenceDiagram\n   src ->> .so: $ go build -o plugin.so\n   .so ->> ./plugins : $ mv plugin.so ./plugins\n   ./plugins ->> runtime: `$ skipper` finds and loads .so\n")]),e._v(" "),e._m(22),e._v(" "),e._m(23),e._m(24),e._v(" "),s("p",[e._v("Data clients pull routes from various sources, such as static files, dynamic Kubernetes ingress objects, etc.")]),e._v(" "),s("mermaid",[e._v("\ngraph TB\n    dataclient --\x3e route-files;\n    dataclient --\x3e route-strings;\n    dataclient --\x3e kubernetes-ingress;\n    dataclient --\x3e etcd;\n    dataclient --\x3e inkeeper;\n")]),e._v(" "),e._m(25),e._v(" "),s("p",[e._v("Skipper's internal package are organized in layers. It has three layers: proxy, skipper, and dataclient.\nThe upstream layer reads data from the downstream layers.")]),e._v(" "),s("mermaid",[e._v("\ngraph TB\n    proxy --\x3e skipper;\n    skipper --\x3e dataclient;\n")]),e._v(" "),e._m(26),e._v(" "),e._m(27),e._v(" "),s("p",[e._v("For each incoming request, skipper routes them following below rules.")]),e._v(" "),e._m(28),e._v(" "),e._m(29),e._v(" "),s("p",[e._v("Skipper is an HTTP router and reverse proxy for service composition. The internal modules are well-decoupled and extendable.\nIt makes adding new data sources and new routing strategies without losing performance.")])],1)},[function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"skipper"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#skipper","aria-hidden":"true"}},[this._v("#")]),this._v(" Skipper")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zalando/skipper/master/img/skipper-h180.png",alt:"Skipper"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"overview"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#overview","aria-hidden":"true"}},[this._v("#")]),this._v(" Overview")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("To handle a large amount of concurrent HTTP routes.")]),this._v(" "),t("li",[this._v("To provide decent ways of HTTP routes configurations.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"use"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#use","aria-hidden":"true"}},[this._v("#")]),this._v(" Use")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",[s("li",[e._v("It can route requests to different destinations based on the request metadata, such as HTTP method, path, query parameters, headers, etc.")]),e._v(" "),s("li",[e._v("It can modify requests and responses.")]),e._v(" "),s("li",[e._v("It can stream requests and responses.")]),e._v(" "),s("li",[e._v("It can hot-reload routing rules.")]),e._v(" "),s("li",[e._v("It can serve as a static file server.")]),e._v(" "),s("li",[e._v("It can serve as Kubernetes Ingress controller.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"concepts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#concepts","aria-hidden":"true"}},[this._v("#")]),this._v(" Concepts")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"http-proxy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http-proxy","aria-hidden":"true"}},[this._v("#")]),this._v(" HTTP Proxy")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ol",[t("li",[this._v("The client sends a request to the proxy first.")]),this._v(" "),t("li",[this._v("Then, the proxy forwards the request to the server.")]),this._v(" "),t("li",[this._v("Afterward, the server sends the response to the proxy.")]),this._v(" "),t("li",[this._v("Finally, the proxy receives the response and forwards back to the client.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"route"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#route","aria-hidden":"true"}},[this._v("#")]),this._v(" Route")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("One or more predicates, which are for finding a path for the request.")]),this._v(" "),t("li",[this._v("One or more filters, which are for modifying the request and the response.")]),this._v(" "),t("li",[this._v("The target, which can be a backend HTTP server, or solely handled by Skipper.")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("type")]),e._v(" Route "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// The preprocessed custom predicate instances.")]),e._v("\n    Predicates "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("Predicate\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// The preprocessed filter instances.")]),e._v("\n    Filters "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("RouteFilter\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// The backend scheme and host.")]),e._v("\n    Scheme"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" Host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" Path "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"routing-table"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#routing-table","aria-hidden":"true"}},[this._v("#")]),this._v(" Routing Table")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"predicates"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#predicates","aria-hidden":"true"}},[this._v("#")]),this._v(" Predicates")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('foo:\n    Host("enqueuezero.com")\n    && Method("GET")\n    && Path("/concrete-architecture/skipper.html")\n    -> "http://0.0.0.0:8080/";\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"filters"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#filters","aria-hidden":"true"}},[this._v("#")]),this._v(" Filters")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('foo: * -> setRequestHeader("X-Routed-By", "skipper") -> "https://enqueuezero.com";\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"scripts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#scripts","aria-hidden":"true"}},[this._v("#")]),this._v(" Scripts")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("header"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"X-Routed-By"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"skipper"')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("end")]),e._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('foo: * -> lua("/path/to/script.lua") -> "https://enqueuezero.com";\nbar: * -> lua("function request(c, p); print(c.request.url); end");\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"plugins"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#plugins","aria-hidden":"true"}},[this._v("#")]),this._v(" Plugins")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Plugins are dynamically linked libraries in the plugin directories, for example, "),t("code",[this._v("$cwd/plugins/plugin.so")]),this._v(". Any file with the suffix "),t("code",[this._v(".so")]),this._v(" found in the plugin directories will be loaded.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("The implementations of plugins are not in the core codebase of skipper. To get a "),t("code",[this._v(".so")]),this._v(" file, as a plugin developer, you need to use "),t("code",[this._v("go build")]),this._v(" like below.")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$ "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("GO111MODULE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("on go build -buildmode"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("plugin -o example.so example.go\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mv")]),e._v(" example.so /path/to/skipper/plugins/example.so\n$ skipper\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("APP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" found plugin example at plugins/example.so\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("APP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("0000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" loaded plugin example from plugins/example.so\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"data-clients"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#data-clients","aria-hidden":"true"}},[this._v("#")]),this._v(" Data Clients")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"layered-architecture"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#layered-architecture","aria-hidden":"true"}},[this._v("#")]),this._v(" Layered Architecture")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("The proxy layer handles requests based on the routes populated by downstream layer skipper.")]),this._v(" "),t("li",[this._v("The skipper layer pulls routes from different sources in dataclient layer.")]),this._v(" "),t("li",[this._v("The dataclient layer read routes from either static files or network remote calls.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"route-processing"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#route-processing","aria-hidden":"true"}},[this._v("#")]),this._v(" Route Processing")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",[s("li",[s("code",[e._v("proxy")]),e._v(" create a request context.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" looks up from the routing table by matching predicates.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" found the route.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" checks rate limit and circuit breaker.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" applies all filters to the request.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" forwards the request to a backend, "),s("code",[e._v("<shunt>")]),e._v(", or "),s("code",[e._v("<loopback>")]),e._v(".")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" retries if the forwarding encounters a network error.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" waits from backend processing.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" received backend response.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" applies all filters to the response.")]),e._v(" "),s("li",[s("code",[e._v("proxy")]),e._v(" forwards the response back to the client.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"conclusions"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#conclusions","aria-hidden":"true"}},[this._v("#")]),this._v(" Conclusions")])}],!1,null,null,null);t.default=a.exports}}]);