(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{232:function(e,t,r){"use strict";r.r(t);var a=r(0),s=Object(a.a)({},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"content"},[e._m(0),e._v(" "),r("p"),e._m(1),r("p"),e._v(" "),e._m(2),e._v(" "),e._m(3),e._v(" "),r("p",[e._v("HyperLogLog can provide estimated count on a very large data stream.")]),e._v(" "),e._m(4),e._v(" "),e._m(5),e._v(" "),e._m(6),e._v(" "),r("p",[e._v("References:")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"http://blog.notdot.net/2012/09/Dam-Cool-Algorithms-Cardinality-Estimation",target:"_blank",rel:"noopener noreferrer"}},[e._v("Damn Cool Algorithms: Cardinality Estimation"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"http://www.moderndescartes.com/essays/hyperloglog/index.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Using Linear Counting, LogLog, and HyperLogLog to Estimate Cardinality"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://djhworld.github.io/hyperloglog/",target:"_blank",rel:"noopener noreferrer"}},[e._v("HyperLogLog  Playground"),r("OutboundLink")],1)])]),e._v(" "),e._m(7),e._v(" "),e._m(8),e._v(" "),r("p",[e._v("HyperLogLogPlusPlus is an enhancement of HyperLogLog.")]),e._v(" "),e._m(9),e._v(" "),e._m(10),e._v(" "),e._m(11),e._v(" "),e._m(12),e._v(" "),e._m(13),r("p",[e._v("References:")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"http://antirez.com/news/75",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis new data structure: the HyperLogLog"),r("OutboundLink")],1),e._v(": If you're developing a web service, Redis might be a good choice.")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://robots.thoughtbot.com/hyperloglogs-in-redis",target:"_blank",rel:"noopener noreferrer"}},[e._v("HyperLogLogs in Redis"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://redis.io/commands/pfadd",target:"_blank",rel:"noopener noreferrer"}},[e._v("PFADD"),r("OutboundLink")],1),e._v(": Add all the element arguments to the HyperLogLog data structure referenced as "),r("code",[e._v("key")]),e._v(".")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://redis.io/commands/pfcount",target:"_blank",rel:"noopener noreferrer"}},[e._v("PFCOUNT"),r("OutboundLink")],1),e._v(": Get the approximated cardinality computed by the HyperLogLog data structure")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://redis.io/commands/pfmerge",target:"_blank",rel:"noopener noreferrer"}},[e._v("PFMERGE"),r("OutboundLink")],1),e._v(": Merge multiple HyperLogLog values into one.")])]),e._v(" "),e._m(14),e._v(" "),e._m(15),e._v(" "),e._m(16),r("p",[e._v("Run the script:")]),e._v(" "),e._m(17),r("p",[e._v("References:")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://ekzhu.github.io/datasketch/hyperloglog.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("datasketch - big data looks small"),r("OutboundLink")],1),e._v(": If you're trying to write a simple Python script to solve problem, datasketch might be a good choice.")])]),e._v(" "),e._m(18),e._v(" "),r("p",[e._v("Logswan can find unique IP addresses in very large log files but only consumes 4MB memory.")]),e._v(" "),e._m(19),r("p",[e._v("References:")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://www.logswan.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("logswan - Fast Web log analyzer using probabilistic data structures"),r("OutboundLink")],1),e._v(": Good choice for unique visitors counting on common logging file.")])]),e._v(" "),e._m(20),e._v(" "),e._m(21),e._v(" "),e._m(22),e._v(" "),e._m(23),e._v(" "),r("p",[e._v("References:")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://gist.github.com/DavidJFelix/113fad6a0a7affdd880d",target:"_blank",rel:"noopener noreferrer"}},[e._v("A lab for HyperLogLogs using Redis & Python"),r("OutboundLink")],1)])])])},[function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"hyperloglog"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hyperloglog","aria-hidden":"true"}},[this._v("#")]),this._v(" HyperLogLog")])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"table-of-contents"},[r("ul",[r("li",[r("a",{attrs:{href:"#overview"}},[e._v("Overview")])]),r("li",[r("a",{attrs:{href:"#theory"}},[e._v("Theory")])]),r("li",[r("a",{attrs:{href:"#enhancements"}},[e._v("Enhancements")]),r("ul",[r("li",[r("a",{attrs:{href:"#hyperloglog"}},[e._v("HyperLogLog++")])])])]),r("li",[r("a",{attrs:{href:"#tools"}},[e._v("Tools")]),r("ul",[r("li",[r("a",{attrs:{href:"#redis"}},[e._v("Redis")])]),r("li",[r("a",{attrs:{href:"#datasketch"}},[e._v("Datasketch")])]),r("li",[r("a",{attrs:{href:"#logswan"}},[e._v("Logswan")])])])]),r("li",[r("a",{attrs:{href:"#strategies"}},[e._v("Strategies")]),r("ul",[r("li",[r("a",{attrs:{href:"#short-term-bucket-long-term-merge"}},[e._v("Short-term Bucket & Long-term Merge")])])])])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"overview"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#overview","aria-hidden":"true"}},[this._v("#")]),this._v(" Overview")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("HyperLogLog is an algorithm that can solve "),t("a",{attrs:{href:"count-distinct"}},[this._v("Count Distinct")]),this._v(" problem. A Count Distinct problem is something like getting number 5 for a data set like [1, 3, 2, 1, 5, 2, 4], for it has [1, 2, 3, 4, 5] 5 elements.")])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ul",[r("li",[e._v("Advantage\n"),r("ul",[r("li",[e._v("Fast (O(1)).")]),e._v(" "),r("li",[e._v("Memory efficient.")]),e._v(" "),r("li",[e._v("Can be distributed and paralleled.")])])]),e._v(" "),r("li",[e._v("Disadvantage\n"),r("ul",[r("li",[e._v("Only provides estimated count.")])])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"theory"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#theory","aria-hidden":"true"}},[this._v("#")]),this._v(" Theory")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("Hash each item.")]),this._v(" "),t("li",[this._v("Place each item into 32 buckets based on first 5-bits of the hash.")]),this._v(" "),t("li",[this._v("Update value for each item in 32 buckets based on last 27-bits of the hash.")]),this._v(" "),t("li",[this._v("Apply to some fancy mathematical formulas to get the number based on the 32 buckets data.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"enhancements"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#enhancements","aria-hidden":"true"}},[this._v("#")]),this._v(" Enhancements")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"hyperloglog-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hyperloglog-2","aria-hidden":"true"}},[this._v("#")]),this._v(" HyperLogLog++")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("Uses 64-bit integers rather than 32-bit")]),this._v(" "),t("li",[this._v("Sparse data structure rather than one huge array")]),this._v(" "),t("li",[this._v("Better bias correction algorithm at lower cardinalities.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"tools"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tools","aria-hidden":"true"}},[this._v("#")]),this._v(" Tools")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"redis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis","aria-hidden":"true"}},[this._v("#")]),this._v(" Redis")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Commands "),t("code",[this._v("PFADD")]),this._v(", "),t("code",[this._v("PFCOUNT")]),this._v(", and "),t("code",[this._v("PFMERGE")]),this._v(" are the main interfaces for manipulating HyperLogLog data structure in Redis.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('redis> PFADD hll a b c d e f g\n(integer) 1\nredis> PFCOUNT hll\n(integer) 7\n\nredis> PFADD hll1 foo bar zap a\n(integer) 1\nredis> PFADD hll2 a b c foo\n(integer) 1\nredis> PFMERGE hll3 hll1 hll2\n"OK"\nredis> PFCOUNT hll3\n(integer) 6\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"datasketch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#datasketch","aria-hidden":"true"}},[this._v("#")]),this._v(" Datasketch")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Source code of the script "),t("code",[this._v("test.py")]),this._v(":")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("from datasketch import HyperLogLog\n\ndata = [1, 2, 3, 5, 2, 4, 1, 6, 7]\n\nhll = HyperLogLog()\nfor element in data:\n    hll.update(str(element).encode('utf8'))\n\nprint(f'estimate: {hll.count()}')\nprint(f'real: {len(set(data))}')\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("$ mkdir testdatasketch\n$ python3 -mvenv venv\n$ source venv/bin/activate\n(venv) $ pip install datasketch\n(venv) $ python test.py\nestimate: 7.097484291802821\nreal: 7\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"logswan"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#logswan","aria-hidden":"true"}},[this._v("#")]),this._v(" Logswan")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("$ logswan access.log\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"strategies"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#strategies","aria-hidden":"true"}},[this._v("#")]),this._v(" Strategies")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"short-term-bucket-long-term-merge"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#short-term-bucket-long-term-merge","aria-hidden":"true"}},[this._v("#")]),this._v(" Short-term Bucket & Long-term Merge")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("Keep HyperLogLog data for every 10 minutes for the past 24 hours.")]),this._v(" "),t("li",[this._v("Merge HyperLogLog data into hourly HLL after 24 hours.")]),this._v(" "),t("li",[this._v("Merge HyperLogLog data into daily HLL after 60 days.")]),this._v(" "),t("li",[this._v("...")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Example redis usage: "),t("code",[this._v("PFADD users:<date>:<hour>:<MM> <UID>")]),this._v(", MM=[00, 10, 20, 30, 40, 50]")])}],!1,null,null,null);t.default=s.exports}}]);