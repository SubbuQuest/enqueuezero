(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{246:function(e,t,a){"use strict";a.r(t);var s=a(0),r=Object(s.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content"},[e._m(0),e._v(" "),a("p",[e._v("In this chapter, we'll build a Kubernetes cluster on DigitalOcean.")]),e._v(" "),e._m(1),e._v(" "),a("p",[e._v("Pricing for DigitalOcean Kubernetes is based only on the underlying resources that you use (Droplets, Block Storage, and Load Balancers). Each Kubernetes cluster now starts with two Droplets of your choice, with the same simple pricing available today for Droplets.")]),e._v(" "),e._m(2),e._v(" "),e._m(3),e._v(" "),e._m(4),e._v(" "),e._m(5),e._m(6),e._v(" "),e._m(7),e._v(" "),e._m(8),a("p",[e._v('Go to DigitalOcean dashboard and check "API". '),a("a",{attrs:{href:"https://cloud.digitalocean.com/account/api/tokens",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://cloud.digitalocean.com/account/api/tokens"),a("OutboundLink")],1),e._v("\nIf you haven't created a personal access token before, generate a new token.")]),e._v(" "),e._m(9),e._v(" "),e._m(10),e._m(11),e._v(" "),e._m(12),e._v(" "),e._m(13),e._v(" "),e._m(14),e._m(15),e._v(" "),e._m(16),a("p",[e._v("Apply the change.")]),e._v(" "),e._m(17),a("p",[e._v("Note that such config will add $15 to your bill per month.")]),e._v(" "),e._m(18),e._v(" "),e._m(19),e._v(" "),e._m(20),e._m(21),e._v(" "),e._m(22),e._m(23),e._m(24),e._v(" "),a("p",[e._v("Add a local_file resource:")]),e._v(" "),e._m(25),e._m(26),e._m(27),e._v(" "),e._m(28),a("p",[e._v("If you saw the version is incompatible, try upgrading the server-side.")]),e._v(" "),e._m(29),e._m(30),e._v(" "),a("p",[e._v("Managing Kubernetes Just Got a Lot Simpler, blog.digitalocean.com, "),a("a",{attrs:{href:"https://blog.digitalocean.com/digitalocean-releases-k8s-as-a-service/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://blog.digitalocean.com/digitalocean-releases-k8s-as-a-service/"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("How to Create a Personal Access Token, digitalocean.com, "),a("a",{attrs:{href:"https://www.digitalocean.com/docs/api/create-personal-access-token/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.digitalocean.com/docs/api/create-personal-access-token/"),a("OutboundLink")],1)])])},[function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"create-a-kubernetes-cluster-on-digitalocean"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-a-kubernetes-cluster-on-digitalocean","aria-hidden":"true"}},[this._v("#")]),this._v(" Create a Kubernetes Cluster on DigitalOcean")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"why-use-digitalocean"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#why-use-digitalocean","aria-hidden":"true"}},[this._v("#")]),this._v(" Why Use DigitalOcean")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"create-cluster"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-cluster","aria-hidden":"true"}},[this._v("#")]),this._v(" Create Cluster")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"preparation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#preparation","aria-hidden":"true"}},[this._v("#")]),this._v(" Preparation")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Install "),t("code",[this._v("terraform")]),this._v(". For macOS users, you can install terraform via Homebrew.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("$ brew "),t("span",{pre:!0,attrs:{class:"token function"}},[this._v("install")]),this._v(" terraform\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"setup-provider"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setup-provider","aria-hidden":"true"}},[this._v("#")]),this._v(" Setup Provider")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Create a file "),t("code",[this._v("deploy/digitalocean/main.tf")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('variable "do_token" {}\n\nprovider "digitalocean" {\n  token = "${var.do_token}"\n}\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Copy the new generated token and save it to "),t("code",[this._v("deploy/digitalocean/terraform.tfvars")]),this._v(".")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('do_token = "logxywonfrzplzygbnbvxaxgxsuxltfncfxkhsgzqmwlhicnif"\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"warning custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),t("p",[this._v("Don't commit "),t("code",[this._v("deploy/digitalocean/terraform.tfvars")]),this._v(" to git repository.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"create-a-kubernetes-cluster"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-a-kubernetes-cluster","aria-hidden":"true"}},[this._v("#")]),this._v(" Create a Kubernetes Cluster")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Append a "),t("code",[this._v("digitalocean_kubernetes_cluster")]),this._v(" resource to "),t("code",[this._v("deploy/digitalocean/main.tf")]),this._v(".")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('variable "cluster-name" {}\nvariable "cluster-region" {}\nvariable "cluster-version" {}\nvariable "cluster-node-pool-name" {}\nvariable "cluster-node-pool-size" {}\nvariable "cluster-node-pool-node-count" {}\n\nresource "digitalocean_kubernetes_cluster" "cluster" {\n  name    = "${var.cluster-name}"\n  region  = "${var.cluster-region}"\n  version = "${var.cluster-version}"\n  tags = ["${var.cluster-name}"]\n\n  node_pool {\n    name       = "${var.cluster-node-pool-name}"\n    size       = "${var.cluster-node-pool-size}"\n    node_count = "${var.cluster-node-pool-node-count}"\n  }\n}\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Append parameters to "),t("code",[this._v("deploy/digitalocean/terraform.tfvars")]),this._v(".")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('cluster-name = "tomato-coffee"\ncluster-region = "sfo2"\ncluster-version = "1.13.1-do.2"\ncluster-node-pool-name = "tomato-coffee-worker-pool"\ncluster-node-pool-size = "s-1vcpu-2gb"\ncluster-node-pool-node-count = 3\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('$ terraform apply -auto-approve\ndigitalocean_kubernetes_cluster.cluster: Creating...\n  cluster_subnet:         "" => "<computed>"\n  created_at:             "" => "<computed>"\n  endpoint:               "" => "<computed>"\n  ipv4_address:           "" => "<computed>"\n  kube_config.#:          "" => "<computed>"\n  name:                   "" => "tomato-coffee"\n\n... (truncated)\n\n  digitalocean_kubernetes_cluster.cluster: Creation complete after 5m23s (ID: 922b3b36-7083-4619-af0c-04a6c16d6219)\n\nApply complete! Resources: 1 added, 0 changed, 0 destroyed.\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"setup-kubernetes-provider"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setup-kubernetes-provider","aria-hidden":"true"}},[this._v("#")]),this._v(" Setup Kubernetes Provider")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Append the kubernetes provider to "),t("code",[this._v("deploy/digitalocean/main.tf")]),this._v(" by using the certs generated from previous step.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('provider "kubernetes" {\n  host = "${digitalocean_kubernetes_cluster.cluster.endpoint}"\n\n  client_certificate = "${base64decode(digitalocean_kubernetes_cluster.cluster.kube_config.0.client_certificate)}"\n  client_key = "${base64decode(digitalocean_kubernetes_cluster.cluster.kube_config.0.client_key)}"\n  cluster_ca_certificate = "${base64decode(digitalocean_kubernetes_cluster.cluster.kube_config.0.cluster_ca_certificate)}"\n}\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"create-a-namespace"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-a-namespace","aria-hidden":"true"}},[this._v("#")]),this._v(" Create a Namespace")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('resource "kubernetes_namespace" "prod" {\n  metadata {\n    name = "${var.cluster-name}"\n    labels {\n      env = "prod"\n    }\n  }\n}\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('$ terraform apply -auto-approve\ndigitalocean_kubernetes_cluster.cluster: Refreshing state... (ID: 922b3b36-7083-4619-af0c-04a6c16d6219)\nkubernetes_namespace.prod: Creating...\n  metadata.#:                  "" => "1"\n  metadata.0.generation:       "" => "<computed>"\n  metadata.0.labels.%:         "" => "1"\n  metadata.0.labels.env:       "" => "prod"\n  metadata.0.name:             "" => "tomato-coffee"\n  metadata.0.resource_version: "" => "<computed>"\n  metadata.0.self_link:        "" => "<computed>"\n  metadata.0.uid:              "" => "<computed>"\nkubernetes_namespace.prod: Creation complete after 1s (ID: tomato-coffee)\n\nApply complete! Resources: 1 added, 0 changed, 0 destroyed.\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"export-kubeconfig"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#export-kubeconfig","aria-hidden":"true"}},[this._v("#")]),this._v(" Export Kubeconfig")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('resource "local_file" "kubeconfig" {\n  content = "${digitalocean_kubernetes_cluster.cluster.kube_config.0.raw_config}"\n  filename = "${path.module}/.kubeconfig"\n}\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("kubectl --kubeconfig .kubeconfig get nodes\nNAME                       STATUS     ROLES    AGE   VERSION\nxenodochial-meitner-8lq3   Ready      <none>   34h   v1.13.1\nxenodochial-meitner-8lq8   Ready      <none>   34h   v1.13.1\nxenodochial-meitner-8lu1   Ready      <none>   34h   v1.13.1\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"install-helm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#install-helm","aria-hidden":"true"}},[this._v("#")]),this._v(" Install Helm")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("$ brew install kubernetes-helm\n$ KUBECONFIG=.kubeconfig helm init --client-only\n")])])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("KUBECONFIG")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(".kubeconfig helm list\nError: incompatible versions client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("v2.12.3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("v2.9.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("KUBECONFIG")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(".kubeconfig helm init --upgrade\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$HELM_HOME")]),e._v(" has been configured at /Users/soasme/.helm.\n\nTiller "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("the Helm server-side component"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" has been upgraded to the current version.\nHappy Helming"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!")]),e._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"references"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#references","aria-hidden":"true"}},[this._v("#")]),this._v(" References")])}],!1,null,null,null);t.default=r.exports}}]);